

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Maintain Your Domain with Scripts &mdash; Project Athena Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/fav-icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="View Domain Server Logs" href="view-logs.html" />
    <link rel="prev" title="Update to the Latest Version" href="update-software.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://projectathena.io/">
          

          
            
            <img src="../../_static/project-athena-logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Project Athena Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<p style="margin-bottom: 10px; margin-top: 10px;"><a href="https://apidocs.projectathena.dev">Looking for <strong>API Reference</strong><br />Documentation?</a></p>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../home.html">HOME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../explore.html">EXPLORE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../create.html">CREATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../script.html">SCRIPT</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../host.html">HOST</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../start-hosting.html">Get Started with Hosting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server-setup.html">Set Up a Domain Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configure-settings.html">Configure Your Domain Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../add-content.html">Add Content to Your Domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../invite-users.html">Bring Visitors to Your Domain</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../maintain-domain.html">Maintain Your Domain</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="backup-domain.html">Backup and Restore Your Domain</a></li>
<li class="toctree-l3"><a class="reference internal" href="manage-visitors.html">Manage Domain Visitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="update-software.html">Update to the Latest Version</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Maintain Your Domain with Scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="view-logs.html">View Domain Server Logs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute.html">CONTRIBUTE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../develop.html">DEVELOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">RELEASE NOTES</a></li>
<li class="toctree-l1"><a class="reference external" href="https://apidocs.projectathena.dev">API REFERENCE</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Athena Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          






















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    You are here: 
      <li><a href="../../index.html"><i class="fa fa-home"></i></a> &raquo;</li>
        
          <li><a href="../../host.html">Host</a> &raquo;</li>
        
          <li><a href="../maintain-domain.html">Maintain Your Domain</a> &raquo;</li>
        
      <li>Maintain Your Domain with Scripts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/kasenvr/athena-docs-sphinx/blob/master/docs/source/host/maintain-domain/script-maintenance.rst" class="fa fa-github"></a><a href="https://github.com/kasenvr/athena-docs-sphinx/blob/master/docs/source/host/maintain-domain/script-maintenance.rst"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="maintain-your-domain-with-scripts">
<h1><a class="toc-backref" href="#id1">Maintain Your Domain with Scripts</a><a class="headerlink" href="#maintain-your-domain-with-scripts" title="Permalink to this headline">¶</a></h1>
<p>You can “clean up” your domain using an <a class="reference internal" href="../../script/assignment-client-scripts.html"><span class="doc">assignment client script</span></a> that regularly performs maintenance tasks on your domain. For example, a script can remove entities that are not part of your default content set, load tools to help you inspect the contents of your domain, or identify loud avatars  and them in your domain.</p>
<div class="contents topic" id="on-this-page">
<p class="topic-title first">On This Page</p>
<ul class="simple">
<li><p><a class="reference internal" href="#maintain-your-domain-with-scripts" id="id1">Maintain Your Domain with Scripts</a></p>
<ul>
<li><p><a class="reference internal" href="#write-a-script" id="id2">Write a Script</a></p></li>
<li><p><a class="reference internal" href="#add-assignment-client-script-to-domain" id="id3">Add Assignment Client Script to Domain</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="write-a-script">
<h2><a class="toc-backref" href="#id2">Write a Script</a><a class="headerlink" href="#write-a-script" title="Permalink to this headline">¶</a></h2>
<p>With scripts, you are free to use our expansive <a class="reference external" href="https://apidocs.highfidelity.com">JavaScript API</a> to code any task that your programming expertise and creativity can come up with. Here, we’ve written an example assignment client script that returns our domain content to its default state every 1 hour. This means that any other entities rezz’d in our domain will be deleted within the hour by the script:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">SEARCH_CENTER</span> <span class="o">=</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="mi">0</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">SEARCH_AREA</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">;</span> <span class="c1">// search area (sphere) in meters radius</span>
<span class="kd">var</span> <span class="nx">CLEANUP_INTERVAL_MIN</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">MINUTES_TO_MILLISECONDS</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ENTITIES_TO_KEEP</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;{ENTITY_ID1}&quot;</span><span class="p">,</span> <span class="s2">&quot;{ENTITY_ID2}&quot;</span><span class="p">]</span>

<span class="kd">var</span> <span class="nx">initialized</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">interval</span><span class="p">;</span>

<span class="nx">Agent</span><span class="p">.</span><span class="nx">isAvatar</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">Avatar</span><span class="p">.</span><span class="nx">skeletonModelURL</span> <span class="o">=</span> <span class="s2">&quot;AVATAR_FST_URL&quot;</span><span class="p">;</span>
<span class="nx">Script</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">initialization</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">cleanup</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">EntityViewer</span><span class="p">.</span><span class="nx">queryOctree</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">foundEntities</span> <span class="o">=</span> <span class="nx">Entities</span><span class="p">.</span><span class="nx">findEntities</span><span class="p">(</span><span class="nx">SEARCH_CENTER</span><span class="p">,</span> <span class="nx">SEARCH_AREA</span><span class="p">);</span>
  <span class="nx">print</span><span class="p">(</span><span class="s2">&quot;Found: &quot;</span> <span class="o">+</span> <span class="nx">foundEntities</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; entities&quot;</span><span class="p">);</span>
  <span class="nx">foundEntities</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entityID</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">ENTITIES_TO_KEEP</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">entityID</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">print</span><span class="p">(</span><span class="s2">&quot;Need to delete: &quot;</span> <span class="o">+</span> <span class="nx">entityID</span><span class="p">);</span>
      <span class="nx">Entities</span><span class="p">.</span><span class="nx">deleteEntity</span><span class="p">(</span><span class="nx">entityID</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initialization</span><span class="p">(</span><span class="nx">deltaTime</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">initialized</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">Entities</span><span class="p">.</span><span class="nx">serversExist</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">Entities</span><span class="p">.</span><span class="nx">canRez</span><span class="p">())</span> <span class="p">{</span>
     <span class="nx">Entities</span><span class="p">.</span><span class="nx">setPacketsPerSecond</span><span class="p">(</span><span class="mi">60000</span><span class="p">);</span>
       <span class="nx">EntityViewer</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">SEARCH_CENTER</span><span class="p">);</span>
       <span class="nx">EntityViewer</span><span class="p">.</span><span class="nx">setCenterRadius</span><span class="p">(</span><span class="nx">SEARCH_AREA</span><span class="p">);</span>
       <span class="nx">Script</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
         <span class="nx">EntityViewer</span><span class="p">.</span><span class="nx">queryOctree</span><span class="p">();</span>
       <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
      <span class="nx">initialized</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Script</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">cleanup</span><span class="p">,</span> <span class="nx">CLEANUP_INTERVAL_MIN</span> <span class="o">*</span> <span class="nx">MINUTES_TO_MILLISECONDS</span><span class="p">);</span>
      <span class="nx">Script</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">(</span><span class="nx">initialization</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Script</span><span class="p">.</span><span class="nx">scriptEnding</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">Script</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="add-assignment-client-script-to-domain">
<h2><a class="toc-backref" href="#id3">Add Assignment Client Script to Domain</a><a class="headerlink" href="#add-assignment-client-script-to-domain" title="Permalink to this headline">¶</a></h2>
<p>To run your script on your domain:</p>
<ol class="arabic simple">
<li><p>Save and upload your script to a cloud hosting site.</p></li>
<li><p>Open your domain settings.</p>
<ul class="simple">
<li><p>For cloud hosted domains, go to <a class="reference external" href="https://metaverse.highfidelity.com/user/cloud_domains">https://metaverse.highfidelity.com/user/cloud_domains</a>. Click the “More Options” menu (3 dots on the right-side of the row), then click ‘Domain Server settings’. Log in when prompted.</p></li>
<li><p>For local servers on Windows: Click on the High Fidelity icon in the system tray, then click ‘Settings’.</p></li>
<li><p>For local servers on Mac: Right-click the High Fidelity icon on the top menu bar, then click ‘Settings’.</p></li>
<li><p>For any OS: Open a browser and enter the URL <a class="reference external" href="http://localhost:40100/settings">http://localhost:40100/settings</a>.</p></li>
</ul>
</li>
<li><p>On the top menu bar, select <strong>Content &gt; Scripts</strong>.</p></li>
<li><p>Under ‘Persistent Scripts’, click the <code class="docutils literal notranslate"><span class="pre">+</span></code> icon.</p></li>
<li><p>Paste the URL to your script under ‘Script URL’.</p></li>
<li><p>Save and restart your domain.</p></li>
</ol>
<p>Now, the script will be running persistently on your domain until you either remove it or shut down the domain entirely.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="view-logs.html" class="btn btn-neutral float-right" title="View Domain Server Logs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="update-software.html" class="btn btn-neutral float-left" title="Update to the Latest Version" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, High Fidelity. © Copyright 2020, Project Athena.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  

   

</body>
</html>